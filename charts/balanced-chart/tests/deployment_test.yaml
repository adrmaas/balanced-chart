suite: Deployment tests
templates:
- templates/deployment.yaml
capabilities:
  majorVersion: 1
  minorVersion: 28
tests:
- it: name is correct
  release:
    name: balanced-chart
  asserts:
  - isKind:
      of: Deployment
  - hasDocuments:
      count: 1
  - equal:
      path: metadata.name
      value: balanced-chart
- it: test image values
  set:
    image:
      repository: ghcr.io/balanced-chart
      tag: 1.0.1
      pullPolicy: Always
  release:
    name: balanced-chart
  asserts:
  - hasDocuments:
      count: 1
  - isKind:
      of: Deployment
  - equal:
      path: spec.template.spec.containers[0].image
      value: ghcr.io/balanced-chart:1.0.1
  - equal:
      path: spec.template.spec.containers[0].imagePullPolicy
      value: Always
- it: test for resources
  release:
    name: balanced-chart
  set:
    resources:
      limits:
        cpu: 0.5
        memory: 512Mi
      requests:
        cpu: 0.25
        memory: 256Mi
  asserts:
  - isKind:
      of: Deployment
  - hasDocuments:
      count: 1
  - isSubset:
      path: spec.template.spec.containers[0].resources.limits
      content:
        cpu: 0.5
        memory: 512Mi
  - isSubset:
      path: spec.template.spec.containers[0].resources.requests
      content:
        cpu: 0.25
        memory: 256Mi
- it: test default port
  release:
    name: balanced-chart
  set:
    resources:
  asserts:
  - isKind:
      of: Deployment
  - hasDocuments:
      count: 1
  - contains:
      path: spec.template.spec.containers[0].ports
      content:
        name: http
        containerPort: 8080
        protocol: TCP
- it: test default port
  release:
    name: balanced-chart
  set:
    port: 9090
    portName: grpc
  asserts:
  - isKind:
      of: Deployment
  - hasDocuments:
      count: 1
  - contains:
      path: spec.template.spec.containers[0].ports
      content:
        name: grpc
        containerPort: 9090
        protocol: TCP